alue of λ. Create plots of the cross-validation error as a function
of λ. Report the resulting coefficient estimates, and discuss the
results obtained.
(f) Now generate a response vector Y according to the model
Y = β0 + β7 X 7 + ",
and perform forward stepwise selection and the lasso. Discuss
the results obtained.
9. In this exercise, we will predict the number of applications received
using the other variables in the College data set.
(a) Split the data set into a training set and a test set.
(b) Fit a linear model using least squares on the training set, and
report the test error obtained.
(c) Fit a ridge regression model on the training set, with λ chosen
by cross-validation. Report the test error obtained.
(d) Fit a lasso model on the training set, with λ chosen by crossvalidation. Report the test error obtained, along with the number of non-zero coefficient estimates.
(e) Fit a PCR model on the training set, with M chosen by crossvalidation. Report the test error obtained, along with the value
of M selected by cross-validation.
(f) Fit a PLS model on the training set, with M chosen by crossvalidation. Report the test error obtained, along with the value
of M selected by cross-validation.

6.6 Exercises

287

(g) Comment on the results obtained. How accurately can we predict the number of college applications received? Is there much
difference among the test errors resulting from these five approaches?
10. We have seen that as the number of features used in a model increases,
the training error will necessarily decrease, but the test error may not.
We will now explore this in a simulated data set.
(a) Generate a data set with p = 20 features, n = 1,000 observations, and an associated quantitative response vector generated
according to the model
Y = Xβ + ",
where β has some elements that are exactly equal to zero.
(b) Split your data set into a training set containing 100 observations
and a test set containing 900 observations.
(c) Perform best subset selection on the training set, and plot the
training set MSE associated with the best model of each size.
(d) Plot the test set MSE associated with the best model of each
size.
(e) For which model size does the test set MSE take on its minimum
value? Comment on your results. If it takes on its minimum value
for a model containing only an intercept or a model containing
all of the features, then play around with the way that you are
generating the data in (a) until you come up with a scenario in
which the test set MSE is minimized for an intermediate model
size.
(f) How does the model at which the test set MSE is minimized
compare to the true model used to generate the data? Comment
on the coefficient values.
G)
p
r 2
(g) Create a plot displaying
j=1 (βj − β̂j ) for a range of values
of r, where β̂jr is the jth coefficient estimate for the best model
containing r coefficients. Comment on what you observe. How
does this compare to the test MSE plot from (d)?

11. We will now try to predict per capita crime rate in the Boston data
set.
(a) Try out some of the regression methods explored in this chapter,
such as best subset selection, the lasso, ridge regression, and
PCR. Present and discuss results for the approaches that you
consider.
(b) Propose a model (or set of models) that seem to perform well on
this data set, and justify your answer. Make sure that you are
evaluating model performance using validation set error, crossvalidation, or some other reasonable alternative, as opposed to
using training error.

288

6. Linear Model Selection and Regularization

(c) Does your chosen model involve all of the features in the data
set? Why or why not?

7
Moving Beyond Linearity

So far in this book, we have mostly focused on linear models. Linear models
are relatively simple to describe and implement, and have advantages over
other approaches in terms of interpretation and inference. However, standard linear regression can have significant limitations in terms of predictive power. This is because the linearity assumption is almost always an
approximation, and sometimes a poor one. In Chapter 6 we see that we can
improve upon least squares using ridge regression, the lasso, principal components regression, and other techniques. In that setting, the improvement
is obtained by reducing the complexity of the linear model, and hence the
variance of the estimates. But we are still using a linear model, which can
only be improved so far! In this chapter we relax the linearity assumption
while still attempting to maintain as much interpretability as possible. We
do this by examining very simple extensions of linear models like polynomial regression and step functions, as well as more sophisticated approaches
such as splines, local regression, and generalized additive models.
• Polynomial regression extends the linear model by adding extra predictors, obtained by raising each of the original predictors to a power.
For example, a cubic regression uses three variables, X, X 2 , and X 3 ,
as predictors. This approach provides a simple way to provide a nonlinear fit to data.
• Step functions cut the range of a variable into K distinct regions in
order to produce a qualitative variable. This has the effect of fitting
a piecewise constant function.
• Regression splines are more flexible than polynomials and step functions, and in fact are an extension of the two. They involve dividing
the range of X into K distinct regions. Within each region, a polynomial function is fit to the data. However, these polynomials are
© Springer Nature Switzerland AG 2023
G. James et al., An Introduction to Statistical Learning, Springer Texts in Statistics,
https://doi.org/10.1007/978-3-031-38747-0_7

289

290

7. Moving Beyond Linearity

constrained so that they join smoothly at the region boundaries, or
knots. Provided that the interval is divided into enough regions, this
can produce an extremely flexible fit.
• Smoothing splines are similar to regression splines, but arise in a
slightly different situation. Smoothing splines result from minimizing
a residual sum of squares criterion subject to a smoothness penalty.
• Local regression is similar to splines, but differs in an important way.
The regions are allowed to overlap, and indeed they do so in a very
smooth way.
• Generalized additive models allow us to extend the methods above to
deal with multiple predictors.
In Sections 7.1–7.6, we present a number of approaches for modeling the
relationship between a response Y and a single predictor X in a flexible
way. In Section 7.7, we show that these approaches can be seamlessly integrated in order to model a response Y as a function of several predictors
X1 , . . . , X p .

7.1

Polynomial Regression

Historically, the standard way to extend linear regression to settings in
which the relationship between the predictors and the response is nonlinear has been to replace the standard linear model
yi = β 0 + β 1 x i + " i
with a polynomial function
yi = β0 + β1 xi + β2 x2i + β3 x3i + · · · + βd xdi + "i ,

(7.1)

where "i is the error term. This approach is known as polynomial regression,
polynomial
and in fact we saw an example of this method in Section 3.3.2. For large regression
enough degree d, a polynomial regression allows us to produce an extremely
non-linear curve. Notice that the coefficients in (7.1) can be easily estimated
using least squares linear regression because this is just a standard linear
model with predictors xi , x2i , x3i , . . . , xdi . Generally speaking, it is unusual
to use d greater than 3 or 4 because for large values of d, the polynomial
curve can become overly flexible and can take on some very strange shapes.
This is especially true near the boundary of the X variable.
The left-hand panel in Figure 7.1 is a plot of wage against age for the
Wage data set, which contains income and demographic information for
males who reside in the central Atlantic region of the United States. We
see the results of fitting a degree-4 polynomial using least squares (solid
blue curve). Even though this is a linear regression model like any other,
the individual coefficients are not of particular interest. Instead, we look at
the entire fitted function across a grid of 63 values for age from 18 to 80 in
order to understand the relationship between age and wage.

7.1 Polynomial Regression

291

| || | || | | || | || || | || | || || | || || | || | || | | | | | || | || |

|

0.10
0.05

Pr(Wage>250 | Age)

200
150

0.00

50

100

Wage

|

0.15

250

300

0.20

Degree−4 Polynomial

20

30

40

50
Age

60

70

80

||| || || ||| ||| ||| ||| ||| ||| ||||| ||||| ||| ||| ||||| ||||| ||||| ||||| ||| ||||| ||| ||| ||| ||| ||||| ||| ||| ||||| ||| ||| ||| ||| ||| ||| ||| ||| ||||| ||| || ||| ||| ||| || ||| ||||| || ||| || || || || ||| || || || || | | || || |

20

30

40

50

60

70

||

80

Age

FIGURE 7.1. The Wage data. Left: The solid blue curve is a degree-4 polynomial
of wage (in thousands of dollars) as a function of age, fit by least squares. The
dashed curves indicate an estimated 95 % confidence interval. Right: We model the
binary event wage>250 using logistic regression, again with a degree-4 polynomial.
The fitted posterior probability of wage exceeding $250,000 is shown in blue, along
with an estimated 95 % confidence interval.

In Figure 7.1, a pair of dashed curves accompanies the fit; these are (2×)
standard error curves. Let’s see how these arise. Suppose we have computed
the fit at a particular value of age, x0 :
fˆ(x0 ) = β̂0 + β̂1 x0 + β̂2 x20 + β̂3 x30 + β̂4 x40 .

(7.2)

What is the variance of the fit, i.e. Varfˆ(x0 )? Least squares returns variance
estimates for each of the fitted coefficients β̂j , as well as the covariances
between pairs of coefficient estimates. We can use these to compute the
estimated variance of fˆ(x0 ).1 The estimated pointwise standard error of
fˆ(x0 ) is the square-root of this variance. This computation is repeated
at each reference point x0 , and we plot the fitted curve, as well as twice
the standard error on either side of the fitted curve. We plot twice the
standard error because, for normally distributed error terms, this quantity
corresponds to an approximate 95 % confidence interval.
It seems like the wages in Figure 7.1 are from two distinct populations:
there appears to be a high earners group earning more than $250,000 per
annum, as well as a low earners group. We can treat wage as a binary
variable by splitting it into these two groups. Logistic regression can then
be used to predict this binary response, using polynomial functions of age
1 If Ĉ is the 5 × 5 covariance matrix of the β̂ , and if #T = (1, x , x2 , x3 , x4 ), then
0
j
0
0
0
0
Var[fˆ(x0 )] = #T
0 Ĉ#0 .

292

7. Moving Beyond Linearity

as predictors. In other words, we fit the model
Pr(yi > 250|xi ) =

exp(β0 + β1 xi + β2 x2i + · · · + βd xdi )
.
1 + exp(β0 + β1 xi + β2 x2i + · · · + βd xdi )

(7.3)

The result is shown in the right-hand panel of Figure 7.1. The gray marks
on the top and bottom of the panel indicate the ages of the high earners
and the low earners. The solid blue curve indicates the fitted probabilities
of being a high earner, as a function of age. The estimated 95 % confidence
interval is shown as well. We see that here the confidence intervals are fairly
wide, especially on the right-hand side. Although the sample size for this
data set is substantial (n = 3,000), there are only 79 high earners, which
results in a high variance in the estimated coefficients and consequently
wide confidence intervals.

7.2

Step Functions

Using polynomial functions of the features as predictors in a linear model
imposes a global structure on the non-linear function of X. We can instead
use step functions in order to avoid imposing such a global structure. Here step
we break the range of X into bins, and fit a different constant in each bin. function
This amounts to converting a continuous variable into an ordered categorical
variable.
ordered
In greater detail, we create cutpoints c1 , c2 , . . . , cK in the range of X, categorical
and then construct K + 1 new variables
variable
C0 (X)
C1 (X)
C2 (X)

=
=
=
..
.

CK−1 (X) =
CK (X)
=

I(X < c1 ),
I(c1 ≤ X < c2 ),
I(c2 ≤ X < c3 ),

(7.4)

I(cK−1 ≤ X < cK ),
I(cK ≤ X),

where I(·) is an indicator function that returns a 1 if the condition is true,
indicator
and returns a 0 otherwise. For example, I(cK ≤ X) equals 1 if cK ≤ X, and function
equals 0 otherwise. These are sometimes called dummy variables. Notice
that for any value of X, C0 (X) + C1 (X) + · · · + CK (X) = 1, since X must
be in exactly one of the K + 1 intervals. We then use least squares to fit a
linear model using C1 (X), C2 (X), . . . , CK (X) as predictors2 :
yi = β0 + β1 C1 (xi ) + β2 C2 (xi ) + · · · + βK CK (xi ) + "i .

(7.5)

For a given value of X, at most one of C1 , C2 , . . . , CK can be non-zero.
Note that when X < c1 , all of the predictors in (7.5) are zero, so β0 can
2 We exclude C (X) as a predictor in (7.5) because it is redundant with the intercept.
0
This is similar to the fact that we need only two dummy variables to code a qualitative
variable with three levels, provided that the model will contain an intercept. The decision
to exclude C0 (X) instead of some other Ck (X) in (7.5) is arbitrary. Alternatively, we
could include C0 (X), C1 (X), . . . , CK (X), and exclude the intercept.

7.3 Basis Functions

293

| || | | | | || || || | | || || | || | | || | | | | | | | | || | | | |

|

0.10
0.05

Pr(Wage>250 | Age)

200
150

0.00

50

100

Wage

|

0.15

250

300

0.20

Piecewise Constant

20

30

40

50

60

70

Age

80

|| ||| || || ||| || ||| ||| ||| ||||| ||||| || ||| ||| ||| ||| ||||| ||| ||| |||||||||| |||||||||| ||| ||| ||||| ||||| ||| ||| ||||| ||||| ||| ||||| ||| ||| ||| ||| ||| ||| ||| ||| ||| ||| || || || || || || || || || | || | || || | || |

20

30

40

50

60

70

||

80

Age

FIGURE 7.2. The Wage data. Left: The solid curve displays the fitted value from
a least squares regression of wage (in thousands of dollars) using step functions
of age. The dashed curves indicate an estimated 95 % confidence interval. Right:
We model the binary event wage>250 using logistic regression, again using step
functions of age. The fitted posterior probability of wage exceeding $250,000 is
shown, along with an estimated 95 % confidence interval.

be interpreted as the mean value of Y for X < c1 . By comparison, (7.5)
predicts a response of β0 +βj for cj ≤ X < cj+1 , so βj represents the average
increase in the response for X in cj ≤ X < cj+1 relative to X < c1 .
An example of fitting step functions to the Wage data from Figure 7.1 is
shown in the left-hand panel of Figure 7.2. We also fit the logistic regression
model
Pr(yi > 250|xi ) =

exp(β0 + β1 C1 (xi ) + · · · + βK CK (xi ))
1 + exp(β0 + β1 C1 (xi ) + · · · + βK CK (xi ))

(7.6)

in order to predict the probability that an individual is a high earner on the
basis of age. The right-hand panel of Figure 7.2 displays the fitted posterior
probabilities obtained using this approach.
Unfortunately, unless there are natural breakpoints in the predictors,
piecewise-constant functions can miss the action. For example, in the lefthand panel of Figure 7.2, the first bin clearly misses the increasing trend
of wage with age. Nevertheless, step function approaches are very popular
in biostatistics and epidemiology, among other disciplines. For example,
5-year age groups are often used to define the bins.